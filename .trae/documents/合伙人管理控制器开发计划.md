# 合伙人管理控制器开发计划

## 1. 接口分析
根据 upms-doc.js 文件，合伙人管理需要实现以下接口：

| 方法 | 路径 | 功能 | 操作ID | 权限 |
|------|------|------|--------|------|
| POST | /api/sys/partner | 新增合伙人 | addPartner | system:partner:add |
| GET | /api/sys/partner/{id} | 获取合伙人详情 | getPartnerDetail | system:partner:query |
| PUT | /api/sys/partner/{id} | 更新合伙人 | updatePartner | system:partner:edit |
| DELETE | /api/sys/partner/{id} | 删除合伙人 | deletePartner | system:partner:delete |
| GET | /api/sys/partner/list | 分页查询合伙人列表 | listPartners | system:partner:list |
| POST | /api/sys/partner/{id}/approve | 审批通过合伙人申请 | approvePartner | 系统权限 |
| POST | /api/sys/partner/{id}/reject | 审批拒绝合伙人申请 | rejectPartner | 系统权限 |

## 2. 相关DTO和VO详细定义

### 2.1 数据传输对象 (DTO)

#### SysPartnerAddDTO - 新增合伙人请求
```json
{
  "required": ["bankAccountNumber", "partnerName", "phone"],
  "type": "object",
  "properties": {
    "partnerName": { "type": "string", "description": "合伙人姓名", "example": "张三" },
    "email": { "type": "string", "description": "合伙人邮箱", "example": "zhangsan@example.com" },
    "phone": { "type": "string", "pattern": "^1[3-9]\\d{9}$", "description": "手机号", "example": "13800138000" },
    "bankAccountNumber": { "type": "string", "description": "打款银行卡", "example": "6222021234567890123" },
    "commissionRate": { "type": "number", "maximum": 100, "minimum": 0, "description": "分佣比例(%)", "example": 10 },
    "parentId": { "type": "integer", "format": "int64", "description": "上级合伙人ID", "example": 1 },
    "status": { "type": "integer", "format": "int32", "maximum": 1, "minimum": 0, "description": "状态:1启用 0禁用", "example": 1 },
    "schoolIds": { "type": "array", "description": "关联的学校ID列表，可为空（表示不负责任何区域）", "example": [1, 2, 3], "items": { "type": "integer", "format": "int64" } }
  }
}
```

#### SysPartnerUpdateDTO - 更新合伙人请求
```json
{
  "type": "object",
  "properties": {
    "partnerName": { "type": "string", "description": "合伙人姓名", "example": "张三" },
    "email": { "type": "string", "description": "合伙人邮箱", "example": "zhangsan@example.com" },
    "phone": { "type": "string", "pattern": "^1[3-9]\\d{9}$", "description": "手机号", "example": "13800138000" },
    "bankAccountNumber": { "type": "string", "description": "打款银行卡", "example": "6222021234567890123" },
    "commissionRate": { "type": "number", "maximum": 100, "minimum": 0, "description": "分佣比例(%)", "example": 10 },
    "parentId": { "type": "integer", "format": "int64", "description": "上级合伙人ID", "example": 1 },
    "status": { "type": "integer", "format": "int32", "description": "状态:1启用 0禁用", "example": 1 },
    "schoolIds": { "type": "array", "description": "关联的学校ID列表，可为空（表示不负责任何区域）", "example": [1, 2, 3], "items": { "type": "integer", "format": "int64" } }
  }
}
```

#### SysPartnerQueryDTO - 合伙人查询条件
```json
{
  "type": "object",
  "properties": {
    "page": { "type": "integer", "format": "int32", "minimum": 1, "description": "当前页码，从1开始", "example": 1 },
    "size": { "type": "integer", "format": "int32", "maximum": 100, "minimum": 1, "description": "每页条数", "example": 10 },
    "partnerName": { "type": "string" },
    "orgName": { "type": "string" },
    "status": { "type": "integer", "format": "int32" },
    "phone": { "type": "string" },
    "email": { "type": "string" }
  }
}
```

### 2.2 视图对象 (VO)

#### SysPartnerVO - 合伙人列表项
```json
{
  "type": "object",
  "properties": {
    "id": { "type": "integer", "format": "int64", "description": "合伙人ID", "example": 1 },
    "partnerName": { "type": "string", "description": "合伙人姓名", "example": "张三" },
    "schoolIds": { "type": "array", "description": "管理学校id(列表)", "example": [1, 2, 3], "items": { "type": "integer", "format": "int64" } },
    "schoolNames": { "type": "array", "description": "管理学校名(列表)", "example": ["清华大学", "北京大学"], "items": { "type": "string" } },
    "email": { "type": "string", "description": "合伙人邮箱", "example": "zhangsan@example.com" },
    "phone": { "type": "string", "description": "手机号", "example": "13800138000" },
    "inviteCode": { "type": "string", "description": "推广码(邀请合伙人)", "example": "ABC123" },
    "inviteCodePath": { "type": "string", "description": "推广码二维码路径", "example": "/qrcode/ABC123.png" },
    "paymentAccountId": { "type": "integer", "format": "int64", "description": "打款账户关联id", "example": 1 },
    "bankAccountNumber": { "type": "string", "description": "打款银行卡号", "example": "6222021234567890123" },
    "commissionRate": { "type": "number", "description": "分佣比例(%)", "example": 10 },
    "parentId": { "type": "integer", "format": "int64", "description": "上级合伙人ID", "example": 0 },
    "parentName": { "type": "string", "description": "上级合伙人姓名", "example": "李四" },
    "auditId": { "type": "integer", "format": "int64", "description": "关联的审核表id", "example": 1 },
    "auditStatus": { "type": "integer", "format": "int32", "description": "审核状态:0-待审核,1-审核通过,2-审核拒绝", "example": 1 },
    "status": { "type": "integer", "format": "int32", "description": "状态:1启用 0禁用", "example": 1 },
    "createdAt": { "type": "string", "format": "date-time", "description": "创建时间" },
    "updatedAt": { "type": "string", "format": "date-time", "description": "更新时间" }
  }
}
```

#### SysPartnerDetailVO - 合伙人详情
```json
{
  "type": "object",
  "properties": {
    "id": { "type": "integer", "format": "int64", "description": "合伙人ID", "example": 1 },
    "partnerName": { "type": "string", "description": "合伙人姓名", "example": "张三" },
    "email": { "type": "string", "description": "合伙人邮箱", "example": "zhangsan@example.com" },
    "phone": { "type": "string", "description": "手机号", "example": "13800138000" },
    "paymentAccountId": { "type": "integer", "format": "int64", "description": "打款账户关联id", "example": 1 },
    "bankAccountNumber": { "type": "string", "description": "打款银行卡号", "example": "6222021234567890123" },
    "commissionRate": { "type": "number", "description": "分佣比例(%)", "example": 10 },
    "parentId": { "type": "integer", "format": "int64", "description": "上级合伙人ID", "example": 0 },
    "parentName": { "type": "string", "description": "上级合伙人姓名", "example": "李四" },
    "auditId": { "type": "integer", "format": "int64", "description": "关联的审核表id", "example": 1 },
    "auditStatus": { "type": "integer", "format": "int32", "description": "审核状态:0-待审核,1-审核通过,2-审核拒绝", "example": 1 },
    "status": { "type": "integer", "format": "int32", "description": "状态:1启用 0禁用", "example": 1 },
    "createdAt": { "type": "string", "format": "date-time", "description": "创建时间" },
    "updatedAt": { "type": "string", "format": "date-time", "description": "更新时间" },
    "allPartners": { "type": "array", "description": "所有合伙人列表（用于选择上级合伙人）", "example": [{ "id": 1, "partnerName": "张三" }], "items": { "$ref": "#/components/schemas/PartnerOption" } }
  }
}
```

#### PageResultSysPartnerVO - 合伙人分页结果
```json
{
  "type": "object",
  "properties": {
    "current": { "type": "integer", "format": "int64" },
    "pageSize": { "type": "integer", "format": "int64" },
    "total": { "type": "integer", "format": "int64" },
    "records": { "type": "array", "items": { "$ref": "#/components/schemas/SysPartnerVO" } }
  }
}
```

## 3. 开发步骤

### 步骤1：创建控制器文件
创建 `PartnerController.java` 文件，位于 `campus-upms/upms-biz/src/main/java/com/example/admin/biz/controller/` 目录下

### 步骤2：实现接口方法
1. 实现新增合伙人接口 `addPartner`
2. 实现获取合伙人详情接口 `getPartnerDetail`
3. 实现更新合伙人接口 `updatePartner`
4. 实现删除合伙人接口 `deletePartner`
5. 实现分页查询合伙人列表接口 `listPartners`
6. 实现审批通过合伙人申请接口 `approvePartner`
7. 实现审批拒绝合伙人申请接口 `rejectPartner`

### 步骤3：添加注解和权限控制
- 添加 `@RestController` 和 `@RequestMapping` 注解
- 添加 `@PreAuthorize` 注解进行权限控制
- 添加 `@Operation` 等Swagger注解

### 步骤4：参考现有控制器
参考 `RoleController.java` 或 `UserController.java` 的实现方式，确保代码风格一致

## 4. 预期结果
完成合伙人管理控制器的开发，实现所有定义的接口，并且符合项目的代码规范和架构设计。