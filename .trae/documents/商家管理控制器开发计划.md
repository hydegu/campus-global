# 商家管理控制器开发计划

## 一、需求分析
根据接口文档，需要实现以下商家管理接口：
1. 分页查询商家列表 - GET /api/merchant/list
2. 获取商家详情 - GET /api/merchant/{id}
3. 新增商家 - POST /api/merchant
4. 更新商家 - PUT /api/merchant/{id}
5. 删除商家 - DELETE /api/merchant/{id}
6. 重置商家密码 - PUT /api/merchant/{id}/reset-password

## 二、技术方案

### 1. 项目结构
采用分层架构：
- controller：处理HTTP请求
- dto：数据传输对象
- service：业务逻辑
- mapper：数据访问
- vo：视图对象

### 2. 需要创建的文件

#### DTO类（biz/dto/）
- `SysMerchantQueryDTO.java` - 商家查询DTO
- `SysMerchantAddDTO.java` - 商家新增DTO
- `SysMerchantUpdateDTO.java` - 商家更新DTO

#### VO类（biz/vo/）
- `SysMerchantVO.java` - 商家列表VO
- `SysMerchantDetailVO.java` - 商家详情VO

#### 控制器类（biz/controller/）
- `MerchantController.java` - 商家管理控制器

#### Service类（biz/service/）
- `MerchantService.java` - 商家服务接口
- `MerchantServiceImpl.java` - 商家服务实现

#### Mapper类（biz/mapper/）
- `MerchantMapper.java` - 商家Mapper接口

## 三、实现步骤

### 1. 创建DTO类
- 实现`SysMerchantQueryDTO`：包含分页参数和查询条件
- 实现`SysMerchantAddDTO`：包含商家新增所需字段
- 实现`SysMerchantUpdateDTO`：包含商家更新所需字段

### 2. 创建VO类
- 实现`SysMerchantVO`：商家列表展示字段
- 实现`SysMerchantDetailVO`：商家详情展示字段

### 3. 创建Mapper接口
- 定义商家相关的数据库操作方法

### 4. 创建Service接口和实现
- 实现商家的增删改查业务逻辑
- 实现密码重置功能

### 5. 创建Controller类
- 实现RESTful接口
- 添加权限控制
- 处理请求参数和响应结果

## 四、详细字段定义

### SysMerchantQueryDTO
| 字段名 | 类型 | 描述 |
|-------|------|------|
| page | Integer | 当前页码，从1开始 |
| size | Integer | 每页条数 |
| orgName | String | 商家名称 |
| auditStatus | Integer | 审核状态 |
| status | Integer | 商家状态 |
| partnerId | Long | 所属合伙人ID |

### SysMerchantAddDTO
| 字段名 | 类型 | 描述 | 必填 |
|-------|------|------|------|
| orgName | String | 商家名称 | 是 |
| email | String | 商家邮箱（用于登录） | 否 |
| password | String | 商家密码 | 否 |
| province | String | 省 | 是 |
| city | String | 市 | 是 |
| district | String | 区 | 是 |
| address | String | 详细地址 | 否 |
| minimumOrderAmount | BigDecimal | 起送金额 | 是 |
| contactPerson | String | 联系人 | 否 |
| contactPhone | String | 联系电话 | 是 |
| sortOrder | Integer | 排序 | 否 |
| bankAccountNumber | String | 结算账户卡号 | 是 |
| bankAccountName | String | 开户名 | 是 |
| partnerId | Long | 所属合伙人ID | 是 |
| status | Integer | 状态 | 否 |

### SysMerchantUpdateDTO
| 字段名 | 类型 | 描述 |
|-------|------|------|
| orgName | String | 商家名称 |
| email | String | 商家邮箱 |
| password | String | 商家密码 |
| province | String | 省 |
| city | String | 市 |
| district | String | 区 |
| address | String | 详细地址 |
| minimumOrderAmount | BigDecimal | 起送金额 |
| contactPerson | String | 联系人 |
| contactPhone | String | 联系电话 |
| sortOrder | Integer | 排序 |
| bankAccountNumber | String | 结算账户卡号 |
| bankAccountName | String | 开户名 |
| partnerId | Long | 所属合伙人ID |
| status | Integer | 状态 |

### SysMerchantVO
| 字段名 | 类型 | 描述 |
|-------|------|------|
| id | Long | 商家ID |
| orgName | String | 商家名称 |
| email | String | 商家邮箱 |
| contactPerson | String | 联系人 |
| contactPhone | String | 联系电话 |
| province | String | 省 |
| city | String | 市 |
| district | String | 区 |
| address | String | 详细地址 |
| sortOrder | Integer | 排序 |
| partnerId | Long | 所属合伙人ID |
| partnerName | String | 所属合伙人姓名 |
| paymentAccount | String | 打款账户 |
| auditStatus | Integer | 审核状态 |
| status | Integer | 状态 |
| createdAt | LocalDateTime | 创建时间 |
| updatedAt | LocalDateTime | 更新时间 |

### SysMerchantDetailVO
| 字段名 | 类型 | 描述 |
|-------|------|------|
| id | Long | 商家ID |
| orgName | String | 商家名称 |
| email | String | 商家邮箱 |
| province | String | 省 |
| city | String | 市 |
| district | String | 区 |
| address | String | 详细地址 |
| contactPerson | String | 联系人 |
| contactPhone | String | 联系电话 |
| sortOrder | Integer | 排序 |
| paymentAccount | String | 打款账户 |
| bankAccountNumber | String | 打款银行卡号 |
| bankAccountName | String | 开户名 |
| partnerId | Long | 所属合伙人ID |
| partnerName | String | 所属合伙人姓名 |
| auditId | Long | 审核记录ID |
| auditStatus | Integer | 审核状态 |
| status | Integer | 状态 |
| createdAt | LocalDateTime | 创建时间 |
| updatedAt | LocalDateTime | 更新时间 |

## 五、接口实现

### 1. 分页查询商家列表
- 路径：`/api/merchant/list`
- 方法：`GET`
- 权限：`merchant:list`
- 参数：`SysMerchantQueryDTO`
- 返回：`PageResult<SysMerchantVO>`

### 2. 获取商家详情
- 路径：`/api/merchant/{id}`
- 方法：`GET`
- 权限：`merchant:detail`
- 参数：`id`（路径参数）
- 返回：`SysMerchantDetailVO`

### 3. 新增商家
- 路径：`/api/merchant`
- 方法：`POST`
- 权限：`merchant:add`
- 参数：`SysMerchantAddDTO`
- 返回：`Void`

### 4. 更新商家
- 路径：`/api/merchant/{id}`
- 方法：`PUT`
- 权限：`merchant:edit`
- 参数：`id`（路径参数），`SysMerchantUpdateDTO`
- 返回：`Void`

### 5. 删除商家
- 路径：`/api/merchant/{id}`
- 方法：`DELETE`
- 权限：`merchant:delete`
- 参数：`id`（路径参数）
- 返回：`Void`

### 6. 重置商家密码
- 路径：`/api/merchant/{id}/reset-password`
- 方法：`PUT`
- 权限：`merchant:edit`
- 参数：`id`（路径参数）
- 返回：`Void`

## 六、注意事项
1. 所有接口需要添加适当的权限控制
2. 数据校验要严格，特别是必填字段
3. 密码需要进行BCrypt加密
4. 软删除实现（设置deleted_at字段）
5. 关联查询要优化，避免N+1问题
6. 异常处理要统一，返回标准的错误格式